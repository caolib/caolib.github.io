<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>mybatis-plus | 学海无涯</title><meta name="keywords" content="mysql,mybatis,java"><meta name="author" content="caolibin"><meta name="copyright" content="caolibin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="mybatis-plus"><meta name="application-name" content="mybatis-plus"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="mybatis-plus"><meta property="og:url" content="https://clibin.gitee.io/2023/08/31/mybatis-plus/index.html"><meta property="og:site_name" content="学海无涯"><meta property="og:description" content="mybatis-plus简介 MyBatis-Plus（简称 MP）是一个 MyBatis的增强工具，在 MyBatis 的基础上&amp;#x3D;&amp;#x3D;只做增强不做改变&amp;#x3D;&amp;#x3D;，为简化开发、提高效率而生。(先了解[[mybatis]]框架)   1.快速开始1.1 导入依赖 导入m"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://img2.imgtp.com/2024/04/26/dAtgB1Oy.jpeg"><meta property="article:author" content="caolibin"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img2.imgtp.com/2024/04/26/dAtgB1Oy.jpeg"><meta name="description" content="mybatis-plus简介 MyBatis-Plus（简称 MP）是一个 MyBatis的增强工具，在 MyBatis 的基础上&amp;#x3D;&amp;#x3D;只做增强不做改变&amp;#x3D;&amp;#x3D;，为简化开发、提高效率而生。(先了解[[mybatis]]框架)   1.快速开始1.1 导入依赖 导入m"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://clibin.gitee.io/2023/08/31/mybatis-plus/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="B68nszCBTyPYshqosfiYmpXO-kEDYDP-yAaADQej-m4"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"别肘,快回来！","backTitle":"♪(^∇^*)！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://clibin-twikoo-comments.hf.space',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":10000,"accessToken":"911b527c61f5ff2539b8f9e1c112ce7d","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"5XB6D5PJUB","apiKey":"07997253594a9ada0ae49be2e2983b26","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: caolibin","link":"链接: ","source":"来源: 学海无涯","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#282C34","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '学海无涯',
  title: 'mybatis-plus',
  postAI: '',
  pageFillDescription: 'mybatis-plus, 简介, 1.快速开始, 1.1 导入依赖, 1.2 创建Mapper, 1.3 测试CRUD, 2.常见注解, 2.1 , 2.2 , 2.3 , 3.常见配置, x3Dx3D4.核心功能x3Dx3D, 4.1 条件构造器, 4.1.1 QueryWrapper, 4.1.2 UpdateWrapper, 4.1.3 LambdaQueryWrapper, 4.2 自定义SQL, 4.2.1 基本使用, 4.2.2 多表联查, 4.3 Service接口, 4.3.1.CRUD, 4.3.2 基本用法, 4.3.3 批量新增, 4.3.4 Lambda, 4.4.静态工具, 5.拓展功能, 5.1 代码生成插件, 5.2 逻辑删除, 5.3 通用枚举, 5.3.1.定义枚举, 5.3.2.配置枚举处理器, 5.3.3.测试, 5.4 字段类型处理器, 5.4.1 定义实体, 5.4.2 使用类型处理器, 5.5配置加密, 5.5.1.生成秘钥, 5.5.2.修改配置, 5.5.3.测试, 6.插件功能, 6.1.分页插件, 6.1.1.配置分页插件, 6.1.2.分页API, 6.2.通用分页实体, 6.2.1.实体, 6.2.2.开发接口, 6.2.3.改造PageQuery实体, 6.2.4.改造PageDTO实体简介简称是一个的增强工具在的基础上只做增强不做改变为简化开发提高效率而生先了解框架快速开始导入依赖导入依赖包含了不用额外再导入依赖创建为了简化单表已经提供了对于单表的操作的接口直接继承接口即可直接使用测试测试中对单表操作英语老师英语老师总结只要继承了就能直接对单表进行操作常见注解问题在刚刚的测试中我们直接调用中的方法就能对表增删改查在继承的时候我们只是指定了一个泛型并没有指定是哪张表那么怎么知道我们要操作的是表呢它又是怎么知道这张表中的所有字段名呢解答其实遵从约定大于配置的思想从类推导出数据库中表名为然后根据类中的所有变量名从驼峰命名转成下划线作为数据库的字段名从而在调用方法时可以自动生成正确的语句如果我们在创建类和表的时候遵从驼峰命名和下划线命名那么我们不需要做额外的配置如果类名和表名属性名和字段名直接不是简单的转换那么我们就不得不使用一些相应的注解来声明表的信息描述表名注解标识实体类对应的表使用位置实体类描述主键注解使用位置实体类主键字段属性类型必须指定默认值描述否主键字段名否指定主键类型支持的类型有值描述数据库自增无状态该类型为未设置主键类型注解里等于跟随全局全局里约等于前自行主键值分配主键类型为和或使用接口的方法默认实现类为雪花算法分配主键类型为使用接口的方法默认方法分布式全局唯一长整型类型位字符串分布式全局唯一字符串类型这里比较常见的有三种利用数据库的自增长手动生成雪花算法生成类型的全局唯一这是默认的策略描述字段注解非主键常见配置也支持基于文件的自定义配置详见官方文档使用配置大多数的配置都有默认值因此我们都无需配置但还有一些是没有默认值的例如实体类的别名扫描包全局类型别名扫描包全局类型为自增长需要注意的是也支持手写的而文件的读取地址可以自己配置文件地址当前这个是默认值可以看到默认值是也就是说我们只要把文件放置这个目录下就一定会被加载使用注解标识类所在目录配置了注解后类中无需添加注解核心功能条件构造器除了新增以外修改删除查询的语句都需要指定条件因此中提供的相关方法除了以作为条件以外还支持更加复杂的条件参数中的就是条件构造的抽象类其下有很多默认实现继承关系如图的子类提供了中包含的所有条件构造方法而在的基础上拓展了一个方法允许指定查询字段而在的基础上拓展了一个方法允许指定中的部分接下来我们就来看看如何利用实现复杂查询修改删除查询都可以使用构建查询条件查询查询名字带有且存款大于等于的人构建查询条件查询数据基于中的方法更新时只能直接赋值对于一些复杂的需求就难以实现例如更新为的用户的余额扣对于的应该是的赋值结果是基于字段现有值的这个时候就要利用中的功能了生成更新注意第一个参数可以给也就是不填更新字段和数据而是基于中的来更新无论是还是在构造条件的时候都需要写死字段名称可能会出现字符串写错的现象因此又提供了一套基于的包含两个分别对应和构建查询条件由原来的字符串变成函数对象获取类属性自定义基本使用在演示的案例中我们在代码中编写了更新的语句这种写法在某些企业也是不允许的因为语句最好都维护在持久层而不是业务层就当前案例来说由于条件是语句只能将写在文件利用来生成动态这实在是太麻烦了假如查询条件更复杂动态的编写也会更加复杂所以提供了自定义功能可以让我们利用生成查询条件再结合或注解编写使用注解完成将作为并使用取出条件是固定写法使用自定义完成将作为参数传入自定义的方法中多表联查理论上来将是不支持多表查询的不过我们可以利用中自定义条件结合自定义来实现多表查询的效果例如我们要查询出所有收货地址在北京的并且用户在之中的用户要是自己基于实现大概是这样的可以看出其中最复杂的就是条件的编写如果业务复杂一些这里的会更变态但是基于自定义结合的玩法我们就可以利用来构建查询条件然后手写及部分实现多表查询查询条件这样来构建准备自定义查询条件北京调用的自定义方法然后在中自定义方法当然也可以在中写总结条件可以使用构建然后作为参数传递接口不仅提供了还提供了通用的接口及默认实现封装了一些常用的模板方法通用接口为默认实现为其中封装的方法可以分为以下几类新增删除更新查询单个结果查询集合结果计数分页查询我们先俩看下基本的接口新增是新增单个元素是批量新增是根据判断如果数据存在就更新不存在则新增是批量的新增或修改删除根据删除根据批量删除根据中的键值对为条件删除根据条件删除暂不支持修改根据修改根据修改中包含和部分按照内的数据修改与匹配到的数据根据批量修改根据查询条数据根据查询条数据获取内的实现某些时候需要直接调用内的自定义时可以用这个方法获取到根据批量查询根据条件查询多条数据查询所有统计所有数量统计符合条件的数据数量当我们在中要调用中自定义时就必须获取对应的就可以通过这个方法基本用法由于中经常需要定义与业务有关的自定义方法因此我们不能直接使用而是自定义接口然后继承以拓展方法同时让自定义的实现类继承这样就不用自己实现中的接口了如下图绿色为接口蓝色为实现类自定义接口继承接口需要指定泛型自定义实现类继承实现自定义接口需要指定对应的和泛型对应的需要继承测试英语老师批量新增中的批量新增功能使用起来非常方便但有一点注意事项我们先来测试一下首先我们测试逐条插入数据耗时英文老师执行结果如下可以看到速度非常慢然后再试试的批处理准备万条数据每条批量插入一次耗时执行最终耗时如下可以看到使用了批处理以后比逐条新增效率提高了倍左右性能还是不错的不过我们简单查看一下源码可以发现其实的批处理是基于的预编译模式然后批量提交最终在数据库执行时还是会有多条语句逐条插入数据类似这样而如果想要得到最佳性能最好是将多条合并为一条像这样该怎么做呢的客户端连接参数中有这样的一个参数顾名思义就是重写批处理的语句参考文档这个参数的默认值是我们需要修改连接参数将其配置为修改项目中的文件在的后面添加参数再次测试插入万条数据可以发现速度有非常明显的提升在的中有判断值是否为并重写的功能最终被重写了总结插入大量数据的时候使用批量插入一定数量的数据而不是在循环里面一条一条插入数据配置文件中开启批处理开启批处理中对和的用法进一步做了简化我们无需自己通过的方式来创建而是直接调用和方法基于查询查询个查询个查询多个查询集合统计则计数可以发现方法中除了可以构建条件而且根据链式编程的最后一个方法来判断最终的返回结果可选的方法有最多个结果返回集合结果返回计数结果还支持动态条件查询比如下面这个需求定义一个方法接收参数为参数可以为空如果参数不为空则采用模糊查询如果参数不为空则采用精确匹配如果参数不为空则余额必须大于如果参数不为空则余额必须小于这个需求就是典型的动态查询在业务开发中经常碰到实现如下基于更新执行方法后基于链式编程可以添加条件和条件但最后一定要跟上否则语句不会执行同样支持动态条件例如下面的需求基于中的方法实现一个更新方法满足下列需求参数为或至少一个不为空根据或精确匹配用户将匹配到的用户余额修改为如果为则将用户修改为冻结状态实现如下静态工具有的时候之间也会相互调用为了避免出现循环依赖问题提供一个静态工具类其中的一些静态方法与中方法签名基本一致也可以帮助我们实现功能示例利用实现复杂条件查询拓展功能代码生成插件安装插件配置数据库生成代码逻辑删除对于一些比较重要的数据我们往往会采用逻辑删除的方案即在表中添加一个字段标记数据是否被删除当删除数据时把标记置为查询时过滤掉标记为的数据一旦采用了逻辑删除所有的查询和删除逻辑都要跟着变化非常麻烦为了解决这个问题就添加了对逻辑删除的支持注意只有生成的语句才支持自动的逻辑删除自定义需要自己手动处理逻辑删除例如我们给表添加一个逻辑删除字段逻辑删除然后给实体添加字段接下来我们要在中配置逻辑删除字段全局逻辑删除的实体字段名配置后可以忽略不配置步骤逻辑已删除值默认为逻辑未删除值默认为测试首先我们执行一个删除操作删除方法与以前没有区别方法与普通删除一模一样但是底层的逻辑变了查询一下试试会发现为的确实没有查询出来而且中也对逻辑删除字段做了判断综上开启了逻辑删除功能以后我们就可以像普通删除一样做基本不用考虑代码逻辑问题还是非常方便的注意逻辑删除本身也有自己的问题比如会导致数据库表垃圾数据越来越多从而影响查询效率中全都需要对逻辑删除字段做判断影响查询效率因此我不太推荐采用逻辑删除功能如果数据不能删除可以采用把数据迁移到其它表的办法通用枚举类中有一个用户状态字段像这种字段我们一般会定义一个枚举做业务判断的时候就可以直接基于枚举做比较但是我们数据库采用的是类型对应的也是因此业务操作时必须手动把枚举与转换非常麻烦因此提供了一个处理枚举的类型转换器可以帮我们把枚举类型与数据库类型自动转换定义枚举我们定义一个用户状态的枚举代码如下正常冻结然后把类中的字段改为类型要让处理枚举与数据库类型自动转换我们必须告诉枚举中的哪个字段的值作为数据库值提供了注解来标记枚举属性配置枚举处理器在文件中添加配置测试最终查询出的类的字段会是枚举类型字段类型处理器数据库的表中有一个字段是类型格式像这样佛系青年而目前实体类中却是类型这样以来我们要读取中的属性时就非常不方便如果要方便获取的类型最好是一个或者实体类而一旦我们把改为对象类型就需要在写入数据库是手动转为再读取数据库时手动转换为对象这会非常麻烦因此提供了很多特殊类型字段的类型处理器解决特殊字段类型与数据库类型转换的问题例如处理就可以使用处理器接下来我们就来看看这个处理器该如何使用定义实体首先我们定义一个单独实体类来与字段的属性匹配代码如下使用类型处理器接下来将类的字段修改为类型并声明类型处理器测试可以发现所有数据都正确封装到当中了配置加密目前我们配置文件中的很多参数都是明文如果开发人员发生流动很容易导致敏感信息的泄露所以支持配置文件的加密和解密功能我们以数据库的用户名和密码为例生成秘钥首先我们利用工具生成一个随机秘钥然后对用户名密码加密生成位随机密钥利用密钥对用户名加密利用密钥对用户名加密打印结果如下修改配置修改文件把的用户名密码修改为刚刚加密生成的密文密文要以开头密文要以开头测试在启动项目的时候需要把刚才生成的秘钥添加到启动参数中像这样单元测试的时候不能添加启动参数所以要在测试类的注解上配置然后随意运行一个单元测试可以发现数据库查询正常插件功能提供了很多的插件功能进一步拓展其功能目前已有的插件有自动分页多租户动态表名乐观锁性能规范防止全表更新与删除注意使用多个分页插件的时候需要注意插件定义顺序建议使用顺序如下多租户动态表名分页乐观锁性能规范防止全表更新与删除这里我们以分页插件为里来学习插件的用法分页插件在未引入分页插件的情况下是不支持分页功能的和中的分页方法都无法正常起效所以我们必须配置分页插件配置分页插件在项目中新建一个配置类其代码如下初始化核心插件添加分页插件分页编写一个分页查询的测试分页查询的两个参数分别是页码每页大小总条数总页数数据运行的如下这里用到了分页参数即可以支持分页参数也可以支持排序参数常见的如下分页参数排序参数通过来指定通用分页实体现在要实现一个用户分页查询的接口接口规范如下参数说明请求方式请求路径请求参数英文老师正常英文老师正常特殊说明如果排序字段为空默认按照更新时间排序排序字段不为空则按照排序字段排序这里需要定义个实体分页查询条件的实体包含分页排序参数分页结果实体包含总条数总页数当前页数据用户页面视图实体接下来我们就按照开发的过程来实现这个接口首先我们在项目中引入依赖依赖工具包然后按打开控制台然后添加一个启动项弹窗中选择弹窗中填写信息其中不要忘了配置我们之前添加的数据加密的秘钥实体首先是请求参数的实体是前端提交的查询参数一般包含四个属性页码每页数据条数排序字段是否升序然后我们定义一个实体代码如下用户用户名详细信息使用状态正常冻结账户余额最后则是分页实体代码如下开发接口我们定义一个在中我们定义分页查询用户的接口然后在中创建方法接下来在中实现该方法构建条件分页条件排序条件默认按照更新时间排序查询数据非空校验无数据返回空结果有数据转换封装返回最后为了让枚举可以展示为文字描述再给中的字段添加注解启动项目在页面查看改造实体在刚才的代码中从到的之间转换的过程还是比较麻烦的我们完全可以在这个实体中定义一个工具方法简化开发像这样分页条件排序条件先看前端有没有传排序字段再看有没有手动指定排序字段这样我们在开发也时就可以省去对从到的的转换构建条件改造实体在查询出分页结果后数据的非空校验数据的转换都是模板代码编写起来很麻烦我们完全可以将其封装到的工具方法中简化整个过程返回空分页结果的分页结果目标类型原始类型的分页对象将分页结果转为分页结果的分页结果目标类型的字节码目标类型原始类型的分页对象非空校验无数据返回空结果数据转换封装返回将分页结果转为分页结果允许用户自定义到的转换方式的分页结果到的转换函数目标类型原始类型的分页对象非空校验无数据返回空结果数据转换封装返回最终业务层的代码可以简化为构建条件查询封装返回如果是希望自定义到的转换过程可以这样做构建条件查询封装返回拷贝属性到用户名脱敏最终查询的结果如下',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-26 13:43:07',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/self/onedark.css"><link rel="stylesheet" href="/self/one-light-theme.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"/></pre></li><script src="https://sdk.51.la/perf/js-sdk-perf.min.js" crossorigin="anonymous"></script><script>new LingQue.Monitor().init({id:"3IEsVRMsUqe5mGFc"});</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://s2.loli.net/2024/06/02/wuJknzxaFigDSdL.gif"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">其他线路</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://clb.pages.dev" title="cloudflare"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/cloudflare.svg" alt="cloudflare"/><span class="back-menu-item-text">cloudflare</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.netlify.app" title="netlify"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/netlify.svg" alt="netlify"/><span class="back-menu-item-text">netlify</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.github.io" title="github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/github.svg" alt="github"/><span class="back-menu-item-text">github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.vercel.app" title="vercel"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/vercel.svg" alt="vercel"/><span class="back-menu-item-text">vercel</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">我</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/caolib" title="github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/github.svg" alt="github"/><span class="back-menu-item-text">github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/clibin" title="gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/gitee.svg" alt="gitee"/><span class="back-menu-item-text">gitee</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">学海无涯</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NOSQL/" style="font-size: 1.05rem;">NOSQL<sup>1</sup></a><a href="/tags/apifox/" style="font-size: 1.05rem;">apifox<sup>1</sup></a><a href="/tags/axios/" style="font-size: 1.05rem;">axios<sup>1</sup></a><a href="/tags/c/" style="font-size: 1.05rem;">c++<sup>1</sup></a><a href="/tags/everything/" style="font-size: 1.05rem;">everything<sup>1</sup></a><a href="/tags/gateway/" style="font-size: 1.05rem;">gateway<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>2</sup></a><a href="/tags/jwt/" style="font-size: 1.05rem;">jwt<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>1</sup></a><a href="/tags/markdown/" style="font-size: 1.05rem;">markdown<sup>1</sup></a><a href="/tags/mybatis/" style="font-size: 1.05rem;">mybatis<sup>2</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>3</sup></a><a href="/tags/nacos/" style="font-size: 1.05rem;">nacos<sup>1</sup></a><a href="/tags/npm/" style="font-size: 1.05rem;">npm<sup>1</sup></a><a href="/tags/os/" style="font-size: 1.05rem;">os<sup>1</sup></a><a href="/tags/pinia/" style="font-size: 1.05rem;">pinia<sup>1</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>2</sup></a><a href="/tags/shields/" style="font-size: 1.05rem;">shields<sup>1</sup></a><a href="/tags/springboot/" style="font-size: 1.05rem;">springboot<sup>2</sup></a><a href="/tags/springcloud/" style="font-size: 1.05rem;">springcloud<sup>2</sup></a><a href="/tags/windows/" style="font-size: 1.05rem;">windows<sup>1</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size: 1.05rem;">搜索<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>2</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE/" style="font-size: 1.05rem;">标签<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">测试<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%82%AE%E4%BB%B6/" style="font-size: 1.05rem;">邮件<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/07/"><span class="card-archive-list-date">七月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/mysql/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>mysql</span></a><a class="article-meta__tags" href="/tags/mybatis/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>mybatis</span></a><a class="article-meta__tags" href="/tags/java/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>java</span></a></span></div></div><h1 class="post-title" itemprop="name headline">mybatis-plus</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-08-31T09:13:56.000Z" title="发表于 2023-08-31 17:13:56">2023-08-31</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-04-26T05:43:07.087Z" title="更新于 2024-04-26 13:43:07">2024-04-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="mybatis-plus"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为江西"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>江西</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://img2.imgtp.com/2024/04/26/dAtgB1Oy.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://clibin.gitee.io/2023/08/31/mybatis-plus/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><a href="/tags/mysql/" tabindex="-1" itemprop="url">mysql</a><a href="/tags/mybatis/" tabindex="-1" itemprop="url">mybatis</a><a href="/tags/java/" tabindex="-1" itemprop="url">java</a><h1 id="CrawlerTitle" itemprop="name headline">mybatis-plus</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">caolibin</span><time itemprop="dateCreated datePublished" datetime="2023-08-31T09:13:56.000Z" title="发表于 2023-08-31 17:13:56">2023-08-31</time><time itemprop="dateCreated datePublished" datetime="2024-04-26T05:43:07.087Z" title="更新于 2024-04-26 13:43:07">2024-04-26</time></header><h1 id="mybatis-plus"><a href="#mybatis-plus" class="headerlink" title="mybatis-plus"></a>mybatis-plus</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a>（简称 MP）是一个 <a target="_blank" rel="noopener" href="https://www.mybatis.org/mybatis-3/">MyBatis</a>的增强工具，在 MyBatis 的基础上&#x3D;&#x3D;只做增强不做改变&#x3D;&#x3D;，为简化开发、提高效率而生。(先了解[[mybatis]]框架)</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/zV34uOPj.png"></p>
<h2 id="1-快速开始"><a href="#1-快速开始" class="headerlink" title="1.快速开始"></a>1.快速开始</h2><h3 id="1-1-导入依赖"><a href="#1-1-导入依赖" class="headerlink" title="1.1 导入依赖"></a>1.1 导入依赖</h3><blockquote>
<p>导入mybatis-plus依赖,包含了mybatis，&#x3D;&#x3D;不用额外再导入mybatis依赖&#x3D;&#x3D;</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="1-2-创建Mapper"><a href="#1-2-创建Mapper" class="headerlink" title="1.2 创建Mapper"></a>1.2 创建Mapper</h3><blockquote>
<p>为了简化单表CRUD，mp已经提供了对于单表的CRUD操作的接口<code>BaseMapper</code>,直接继承BaseMapper接口即可直接使用</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/WiwPW9IW.png"></p>
<h3 id="1-3-测试CRUD"><a href="#1-3-测试CRUD" class="headerlink" title="1.3 测试CRUD"></a>1.3 测试CRUD</h3><blockquote>
<p>测试BaseMapper中对单表CRUD操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInsert</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    <span class="hljs-comment">//user.setId(5L);</span><br>    user.setUsername(<span class="hljs-string">&quot;ikun23&quot;</span>);<br>    user.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>    user.setPhone(<span class="hljs-string">&quot;18688990011&quot;</span>);<br>    user.setBalance(<span class="hljs-number">200</span>);<br>    user.setInfo(UserInfo.of(<span class="hljs-number">24</span>,<span class="hljs-string">&quot;英语老师&quot;</span>,<span class="hljs-string">&quot;female&quot;</span>));<br>    user.setCreateTime(LocalDateTime.now());<br>    user.setUpdateTime(LocalDateTime.now());<br>    userMapper.insert(user);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectById</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectById(<span class="hljs-number">4L</span>);<br>    System.out.println(user);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelectByIds</span><span class="hljs-params">()</span> &#123;<br>    List&lt;User&gt; users = userMapper.selectBatchIds(List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>));<br>    users.forEach(System.out::println);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdate</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setId(<span class="hljs-number">5L</span>);<br>    user.setBalance(<span class="hljs-number">3</span>);<br>    user.setInfo(UserInfo.of(<span class="hljs-number">24</span>,<span class="hljs-string">&quot;英语老师&quot;</span>,<span class="hljs-string">&quot;female&quot;</span>));<br>    user.setCreateTime(LocalDateTime.now());<br>    user.setUpdateTime(LocalDateTime.now());<br><br>    userMapper.updateById(user);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete</span><span class="hljs-params">()</span> &#123;<br>    System.out.println(userMapper.deleteById(<span class="hljs-number">5L</span>));<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>总结：只要继承了<code>BaseMapper</code>，就能直接对单表进行CRUD操作！</p>
</blockquote>
<h2 id="2-常见注解"><a href="#2-常见注解" class="headerlink" title="2.常见注解"></a>2.常见注解</h2><blockquote>
<p><strong>问题</strong>：在刚刚的测试中，我们直接调用BaseMapper中的方法就能对表增删改查，在继承<code>BaseMapper</code>的时候我们只是指定了一个泛型<code>&lt;User&gt;</code>,并没有指定是哪张表，那么&#x3D;&#x3D;mybatis-plus怎么知道我们要操作的是user表呢？它又是怎么知道这张表中的所有字段名呢？&#x3D;&#x3D;</p>
<p>解答：其实mp遵从&#x3D;&#x3D;约定大于配置&#x3D;&#x3D;的思想,mp从<code>User</code>类推导出数据库中表名为<code>user</code>，然后根据User类中的所有变量名从&#x3D;&#x3D;驼峰命名&#x3D;&#x3D;转成&#x3D;&#x3D;下划线&#x3D;&#x3D;作为数据库的字段名，从而在调用方法时可以自动生成正确的sql语句。</p>
<p>如果我们在创建User类和user表的时候遵从驼峰命名和下划线命名，那么我们不需要做额外的配置，如果类名和表名、属性名和字段名直接不是简单的转换，那么我们就不得不使用一些相应的注解来声明表的信息</p>
</blockquote>
<h3 id="2-1-TableName"><a href="#2-1-TableName" class="headerlink" title="2.1 @TableName"></a>2.1 <a target="_blank" rel="noopener" href="https://www.baomidou.com/pages/223848/#tablename">@TableName</a></h3><ul>
<li>描述：表名注解，标识实体类对应的表</li>
<li>使用位置：实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableName(&quot;sys_user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-TableId"><a href="#2-2-TableId" class="headerlink" title="2.2  @TableId"></a>2.2 <a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/TableId.java"> @TableId</a></h3><ul>
<li>描述：主键注解</li>
<li>使用位置：实体类主键字段</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableName(&quot;sys_user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>类型</strong></th>
<th><strong>必须指定</strong></th>
<th><strong>默认值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>主键字段名</td>
</tr>
<tr>
<td>type</td>
<td>Enum</td>
<td>否</td>
<td>&#x3D;&#x3D;IdType.NONE&#x3D;&#x3D;</td>
<td>指定主键类型</td>
</tr>
</tbody></table>
<p><code>IdType</code>支持的类型有：</p>
<table>
<thead>
<tr>
<th><strong>值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>AUTO</td>
<td>数据库 ID 自增</td>
</tr>
<tr>
<td>NONE</td>
<td>无状态，该类型为未设置主键类型（注解里等于跟随全局，全局里约等于 INPUT）</td>
</tr>
<tr>
<td>INPUT</td>
<td>insert 前自行 set 主键值</td>
</tr>
<tr>
<td>ASSIGN_ID</td>
<td>分配 ID(主键类型为 Number(Long 和 Integer)或 String)(since 3.3.0),使用接口IdentifierGenerator的方法nextId(默认实现类为DefaultIdentifierGenerator雪花算法)</td>
</tr>
<tr>
<td>ASSIGN_UUID</td>
<td>分配 UUID,主键类型为 String(since 3.3.0),使用接口IdentifierGenerator的方法nextUUID(默认 default 方法)</td>
</tr>
<tr>
<td><del>ID_WORKER</del></td>
<td>分布式全局唯一 ID 长整型类型(please use ASSIGN_ID)</td>
</tr>
<tr>
<td><del>UUID</del></td>
<td>32 位 UUID 字符串(please use ASSIGN_UUID)</td>
</tr>
<tr>
<td><del>ID_WORKER_STR</del></td>
<td>分布式全局唯一 ID 字符串类型(please use ASSIGN_ID)</td>
</tr>
</tbody></table>
<p>这里比较常见的有三种：</p>
<ul>
<li><code>AUTO</code>：利用数据库的id自增长</li>
<li><code>INPUT</code>：手动生成id</li>
<li><code>ASSIGN_ID</code>：雪花算法生成<code>Long</code>类型的全局唯一id，这是默认的ID策略</li>
</ul>
<h3 id="2-3-TableField"><a href="#2-3-TableField" class="headerlink" title="2.3 @TableField"></a>2.3 <a target="_blank" rel="noopener" href="https://www.baomidou.com/pages/223848/#tablefield">@TableField</a></h3><ul>
<li>描述：字段注解（非主键）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableName(&quot;sys_user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-meta">@TableId</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-meta">@TableField(&quot;nickname&quot;)</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-常见配置"><a href="#3-常见配置" class="headerlink" title="3.常见配置"></a>3.常见配置</h2><p>MybatisPlus也支持基于yaml文件的自定义配置，详见官方文档：<br><a target="_blank" rel="noopener" href="https://www.baomidou.com/pages/56bac0/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">使用配置 | MyBatis-Plus</a></p>
<p>大多数的配置都有默认值，因此我们都无需配置。但还有一些是没有默认值的，例如:</p>
<ul>
<li>实体类的别名扫描包</li>
<li>全局id类型</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.itheima.mp.domain.po</span>	<span class="hljs-comment">#别名扫描包</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span> <span class="hljs-comment"># 全局id类型为自增长</span><br></code></pre></td></tr></table></figure>

<p>需要注意的是，MyBatisPlus也支持手写SQL的，而mapper文件的读取地址可以自己配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">&quot;classpath*:/mapper/**/*.xml&quot;</span> <span class="hljs-comment"># Mapper.xml文件地址，当前这个是默认值。</span><br></code></pre></td></tr></table></figure>

<p>可以看到默认值是<code>classpath*:/mapper/**/*.xml</code>，也就是说我们只要把mapper.xml文件放置这个目录下就一定会被加载。</p>
<p>使用<code>@MapperScan</code>注解标识mapper类所在目录</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@MapperScan(&quot;com.clb.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(App.class, args);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>配置了&#x3D;&#x3D;@MapperScan&#x3D;&#x3D;注解后，mapper类中无需添加&#x3D;&#x3D;@Mapper&#x3D;&#x3D;注解</p>
</blockquote>
<hr>
<h2 id="4-核心功能"><a href="#4-核心功能" class="headerlink" title="&#x3D;&#x3D;4.核心功能&#x3D;&#x3D;"></a><strong>&#x3D;&#x3D;4.核心功能&#x3D;&#x3D;</strong></h2><h3 id="4-1-条件构造器"><a href="#4-1-条件构造器" class="headerlink" title="4.1 条件构造器"></a>4.1 条件构造器</h3><p>除了新增以外，修改、删除、查询的SQL语句都需要指定where条件。因此BaseMapper中提供的相关方法除了以<code>id</code>作为<code>where</code>条件以外，还支持更加复杂的<code>where</code>条件。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/EYycmHcF.png" alt="image.png"><br>参数中的<code>Wrapper</code>就是条件构造的抽象类，其下有很多默认实现，继承关系如图：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/yBBlOx4P.png" alt="image.png"></p>
<p><code>Wrapper</code>的子类<code>AbstractWrapper</code>提供了where中包含的所有条件构造方法：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/mdBy9WoL.png" alt="image.png"><br>而QueryWrapper在AbstractWrapper的基础上拓展了一个select方法，允许指定查询字段：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/hpyUpWuQ.png" alt="image.png"><br>而UpdateWrapper在AbstractWrapper的基础上拓展了一个set方法，允许指定SQL中的SET部分：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/73APzR7R.png" alt="image.png"></p>
<p>接下来，我们就来看看如何利用<code>Wrapper</code>实现复杂查询。</p>
<h4 id="4-1-1-QueryWrapper"><a href="#4-1-1-QueryWrapper" class="headerlink" title="4.1.1 QueryWrapper"></a>4.1.1 QueryWrapper</h4><p>修改、删除、查询都可以使用QueryWrapper构建查询条件</p>
<p><strong>查询：</strong>查询名字带有o，且存款大于等于1000的人</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs mysql">select id,username,info,balance <br>from user<br>where username like %o% and balance &gt;= 1000;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test02</span><span class="hljs-params">()</span> &#123;<br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//构建查询条件</span><br>    wrapper.select(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;info&quot;</span>, <span class="hljs-string">&quot;balance&quot;</span>)<br>        .like(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;o&quot;</span>)<br>        .ge(<span class="hljs-string">&quot;balance&quot;</span>, <span class="hljs-number">1000</span>);<br>    <span class="hljs-comment">//查询数据</span><br>    List&lt;User&gt; users = userMapper.selectList(wrapper);<br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-2-UpdateWrapper"><a href="#4-1-2-UpdateWrapper" class="headerlink" title="4.1.2 UpdateWrapper"></a>4.1.2 UpdateWrapper</h4><p>基于BaseMapper中的update方法更新时只能直接赋值，对于一些复杂的需求就难以实现。<br>例如：更新id为<code>1,2,4</code>的用户的余额，扣200，对于的SQL应该是：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">200</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure>

<p>SET的赋值结果是基于字段现有值的，这个时候就要利用UpdateWrapper中的setSql功能了：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateWrapper</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Long&gt; ids = List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">4L</span>);<br>    <span class="hljs-comment">// 1.生成SQL</span><br>    UpdateWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>&lt;User&gt;()<br>            .setSql(<span class="hljs-string">&quot;balance = balance - 200&quot;</span>) <span class="hljs-comment">// SET balance = balance - 200</span><br>            .in(<span class="hljs-string">&quot;id&quot;</span>, ids); <span class="hljs-comment">// WHERE id in (1, 2, 4)</span><br>	<span class="hljs-comment">// 2.更新，注意第一个参数可以给null，也就是不填更新字段和数据，</span><br>    <span class="hljs-comment">// 而是基于UpdateWrapper中的setSQL来更新</span><br>    userMapper.update(<span class="hljs-literal">null</span>, wrapper);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-1-3-LambdaQueryWrapper"><a href="#4-1-3-LambdaQueryWrapper" class="headerlink" title="4.1.3 LambdaQueryWrapper"></a>4.1.3 LambdaQueryWrapper</h4><p>无论是QueryWrapper还是UpdateWrapper在构造条件的时候都需要写死字段名称，可能会出现字符串写错的现象，因此MybatisPlus又提供了一套基于Lambda的Wrapper，包含两个：</p>
<ul>
<li><code>LambdaQueryWrapper</code></li>
<li><code>LambdaUpdateWrapper</code></li>
</ul>
<p>分别对应<code>QueryWrapper</code>和<code>UpdateWrapper</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs mysql">select id,username,info,balance <br>from user<br>where username like %o% and balance &gt;= 1000;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test02</span><span class="hljs-params">()</span> &#123;<br>    LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    <span class="hljs-comment">//构建查询条件</span><br>    <span class="hljs-comment">//由原来的字符串变成getter函数对象获取类属性</span><br>    wrapper.select(User::getId, User::getUsername, User::getInfo, User::getBalance)<br>        .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>        .ge(User::getBalance, <span class="hljs-number">1000</span>);<br>    userMapper.selectList(wrapper);<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs mysql">UPDATE user SET balance = balance - 200 WHERE id in (1, 2, 4);<br></code></pre></td></tr></table></figure>

<h3 id="4-2-自定义SQL"><a href="#4-2-自定义SQL" class="headerlink" title="4.2 自定义SQL"></a>4.2 自定义SQL</h3><h4 id="4-2-1-基本使用"><a href="#4-2-1-基本使用" class="headerlink" title="4.2.1 基本使用"></a>4.2.1 基本使用</h4><p>在演示<code>UpdateWrapper</code>的案例中，我们在代码中编写了更新的SQL语句：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/kpX6ZbUO.png" alt="image.png"><br>这种写法在某些企业也是不允许的，因为SQL语句最好都维护在持久层，而不是业务层。就当前案例来说，由于条件是in语句，只能将SQL写在Mapper.xml文件，利用foreach来生成动态SQL。<br>这实在是太麻烦了。假如查询条件更复杂，动态SQL的编写也会更加复杂。</p>
<p>所以，MybatisPlus提供了自定义SQL功能，可以让我们利用Wrapper生成查询条件，再结合Mapper.xml或注解编写SQL</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs mysql">UPDATE user SET balance = balance - 200 WHERE id in (1, 2, 4)<br></code></pre></td></tr></table></figure>

<p><code>update user set balance = balance - 200</code>使用注解完成</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//将wrapper作为ew，并使用ew.customSqlSegment取出条件是固定写法</span><br><span class="hljs-meta">@Update(&quot;update tb_user set balance = balance - #&#123;amount&#125; $&#123;ew.customSqlSegment&#125;&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">updateBalanceByWrapper</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;amount&quot;)</span> <span class="hljs-type">int</span> amount, <span class="hljs-meta">@Param(&quot;ew&quot;)</span> LambdaQueryWrapper&lt;User&gt; wrapper)</span>;<br></code></pre></td></tr></table></figure>

<p><code>where id in(1,2,4)</code> 使用自定义sql完成,将wrapper作为参数传入自定义的方法中<code>$&#123;ew.customSqlSegment&#125;</code> &#x3D;&#x3D;&gt;<code> where id in (1,2,4)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCustomSql</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">amount</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;<br>    LambdaQueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();<br>    wrapper.in(User::getId, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>);<br>    userMapper.updateBalanceByWrapper(amount, wrapper);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-2-2-多表联查"><a href="#4-2-2-多表联查" class="headerlink" title="4.2.2 多表联查"></a>4.2.2 多表联查</h4><p>理论上来将MyBatisPlus是不支持多表查询的，不过我们可以利用Wrapper中自定义条件结合自定义SQL来实现多表查询的效果。<br>例如，我们要查询出所有收货地址在北京的并且用户id在1、2、4之中的用户<br>要是自己基于mybatis实现SQL，大概是这样的：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserByIdAndAddr&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.itheima.mp.domain.po.User&quot;</span>&gt;</span><br>    SELECT *<br>    FROM user u<br>    INNER JOIN address a ON u.id = a.user_id<br>    WHERE u.id<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;IN (&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span>&gt;</span><br>        #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br>    AND a.city = #&#123;city&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>可以看出其中最复杂的就是WHERE条件的编写，如果业务复杂一些，这里的SQL会更变态。但是基于自定义SQL结合Wrapper的玩法，我们就可以利用Wrapper来构建查询条件，然后手写SELECT及FROM部分，实现多表查询。<br>查询条件这样来构建：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testCustomJoinWrapper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.准备自定义查询条件</span><br>    QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;User&gt;()<br>            .in(<span class="hljs-string">&quot;u.id&quot;</span>, List.of(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>, <span class="hljs-number">4L</span>))<br>            .eq(<span class="hljs-string">&quot;a.city&quot;</span>, <span class="hljs-string">&quot;北京&quot;</span>);<br><br>    <span class="hljs-comment">// 2.调用mapper的自定义方法</span><br>    List&lt;User&gt; users = userMapper.queryUserByWrapper(wrapper);<br><br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后在UserMapper中自定义方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Select(&quot;SELECT u.* FROM user u INNER JOIN address a ON u.id = a.user_id $&#123;ew.customSqlSegment&#125;&quot;)</span><br>List&lt;User&gt; <span class="hljs-title function_">queryUserByWrapper</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ew&quot;)</span>QueryWrapper&lt;User&gt; wrapper)</span>;<br></code></pre></td></tr></table></figure>

<p>当然，也可以在<code>UserMapper.xml</code>中写SQL：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;queryUserByIdAndAddr&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;com.itheima.mp.domain.po.User&quot;</span>&gt;</span><br>    SELECT * FROM user u INNER JOIN address a ON u.id = a.user_id $&#123;ew.customSqlSegment&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>&#x3D;&#x3D;总结:where条件可以使用wrapper构建，然后作为参数传递&#x3D;&#x3D;</p>
</blockquote>
<h3 id="4-3-Service接口"><a href="#4-3-Service接口" class="headerlink" title="4.3 Service接口"></a>4.3 Service接口</h3><p>MybatisPlus不仅提供了BaseMapper，还提供了通用的Service接口及默认实现，封装了一些常用的service模板方法。<br>通用接口为<code>IService</code>，默认实现为<code>ServiceImpl</code>，其中封装的方法可以分为以下几类：</p>
<ul>
<li><code>save</code>：新增</li>
<li><code>remove</code>：删除</li>
<li><code>update</code>：更新</li>
<li><code>get</code>：查询单个结果</li>
<li><code>list</code>：查询集合结果</li>
<li><code>count</code>：计数</li>
<li><code>page</code>：分页查询</li>
</ul>
<h4 id="4-3-1-CRUD"><a href="#4-3-1-CRUD" class="headerlink" title="4.3.1.CRUD"></a>4.3.1.CRUD</h4><p>我们先俩看下基本的CRUD接口。<br><strong>新增</strong>：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/EHtTllxK.png" alt="image.png"></p>
<ul>
<li><code>save</code>是新增单个元素</li>
<li><code>saveBatch</code>是批量新增</li>
<li><code>saveOrUpdate</code>是根据id判断，如果数据存在就更新，不存在则新增</li>
<li><code>saveOrUpdateBatch</code>是批量的新增或修改</li>
</ul>
<p><strong>删除：</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/hTbeEW9j.png" alt="image.png"></p>
<ul>
<li><code>removeById</code>：根据id删除</li>
<li><code>removeByIds</code>：根据id批量删除</li>
<li><code>removeByMap</code>：根据Map中的键值对为条件删除</li>
<li><code>remove(Wrapper&lt;T&gt;)</code>：根据Wrapper条件删除</li>
<li><code>~~removeBatchByIds~~</code>：暂不支持</li>
</ul>
<p><strong>修改：</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/vmqY49oX.png" alt="image.png"></p>
<ul>
<li><code>updateById</code>：根据id修改</li>
<li><code>update(Wrapper&lt;T&gt;)</code>：根据<code>UpdateWrapper</code>修改，<code>Wrapper</code>中包含<code>set</code>和<code>where</code>部分</li>
<li><code>update(T，Wrapper&lt;T&gt;)</code>：按照<code>T</code>内的数据修改与<code>Wrapper</code>匹配到的数据</li>
<li><code>updateBatchById</code>：根据id批量修改</li>
</ul>
<p><strong>Get：</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/rtihGb60.png" alt="image.png"></p>
<ul>
<li><code>getById</code>：根据id查询1条数据</li>
<li><code>getOne(Wrapper&lt;T&gt;)</code>：根据<code>Wrapper</code>查询1条数据</li>
<li><code>getBaseMapper</code>：获取<code>Service</code>内的<code>BaseMapper</code>实现，某些时候需要直接调用<code>Mapper</code>内的自定义<code>SQL</code>时可以用这个方法获取到<code>Mapper</code></li>
</ul>
<p><strong>List：</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/3InxWOnw.png" alt="image.png"></p>
<ul>
<li><code>listByIds</code>：根据id批量查询</li>
<li><code>list(Wrapper&lt;T&gt;)</code>：根据Wrapper条件查询多条数据</li>
<li><code>list()</code>：查询所有</li>
</ul>
<p><strong>Count</strong>：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/7ZkniJuS.png" alt="image.png"></p>
<ul>
<li><code>count()</code>：统计所有数量</li>
<li><code>count(Wrapper&lt;T&gt;)</code>：统计符合<code>Wrapper</code>条件的数据数量</li>
</ul>
<p><strong>getBaseMapper</strong>：<br>当我们在service中要调用Mapper中自定义SQL时，就必须获取service对应的Mapper，就可以通过这个方法：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/xxVjxhlY.png" alt="image.png"></p>
<h4 id="4-3-2-基本用法"><a href="#4-3-2-基本用法" class="headerlink" title="4.3.2 基本用法"></a>4.3.2 基本用法</h4><p>由于<code>Service</code>中经常需要定义与业务有关的自定义方法，因此我们不能直接使用<code>IService</code>，而是自定义<code>Service</code>接口，然后继承<code>IService</code>以拓展方法。同时，让自定义的<code>Service实现类</code>继承<code>ServiceImpl</code>，这样就不用自己实现<code>IService</code>中的接口了，如下图(<strong>绿色为接口，蓝色为实现类</strong>)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/eLZIQZta.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//自定义接口继承IService接口，需要指定泛型</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//自定义实现类继承ServiceImpl，实现自定义接口，需要指定对应的Mapper和泛型，对应的Mapper需要继承BaseMapper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span><br></code></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSave</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    <span class="hljs-comment">//user.setId(5L);</span><br>    user.setUsername(<span class="hljs-string">&quot;kun_&quot;</span>);<br>    user.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>    user.setPhone(<span class="hljs-string">&quot;18688990011&quot;</span>);<br>    user.setBalance(<span class="hljs-number">2000</span>);<br>    user.setInfo(UserInfo.of(<span class="hljs-number">24</span>, <span class="hljs-string">&quot;英语老师&quot;</span>, <span class="hljs-string">&quot;female&quot;</span>));<br>    user.setCreateTime(LocalDateTime.now());<br>    user.setUpdateTime(LocalDateTime.now());<br>    user.setStatus(UserStatus.NORMAL);<br>    userService.save(user);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGet</span><span class="hljs-params">()</span> &#123;<br>    List&lt;User&gt; users = userService.list(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;().select(User::getUsername, User::getBalance).le(User::getBalance, <span class="hljs-number">999</span>));<br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="4-3-3-批量新增"><a href="#4-3-3-批量新增" class="headerlink" title="4.3.3 批量新增"></a>4.3.3 批量新增</h4><p>IService中的批量新增功能使用起来非常方便，但有一点注意事项，我们先来测试一下。<br>首先我们测试逐条插入数据：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testSaveOneByOne</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100000</span>; i++) &#123;<br>        userService.save(buildUser(i));<br>    &#125;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    System.out.println(<span class="hljs-string">&quot;耗时：&quot;</span> + (e - b));<br>&#125;<br><br><span class="hljs-keyword">private</span> User <span class="hljs-title function_">buildUser</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setUsername(<span class="hljs-string">&quot;user_&quot;</span> + i);<br>    user.setPassword(<span class="hljs-string">&quot;123&quot;</span>);<br>    user.setPhone(<span class="hljs-string">&quot;&quot;</span> + (<span class="hljs-number">18688190000L</span> + i));<br>    user.setBalance(<span class="hljs-number">2000</span>);<br>    user.setInfo(<span class="hljs-string">&quot;&#123;\&quot;age\&quot;: 24, \&quot;intro\&quot;: \&quot;英文老师\&quot;, \&quot;gender\&quot;: \&quot;female\&quot;&#125;&quot;</span>);<br>    user.setCreateTime(LocalDateTime.now());<br>    user.setUpdateTime(user.getCreateTime());<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执行结果如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/9hiuZHou.png" alt="image.png"><br>可以看到速度非常慢。</p>
<p>然后再试试MybatisPlus的批处理：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testSaveBatch</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 准备10万条数据</span><br>    List&lt;User&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(<span class="hljs-number">1000</span>);<br>    <span class="hljs-type">long</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100000</span>; i++) &#123;<br>        list.add(buildUser(i));<br>        <span class="hljs-comment">// 每1000条批量插入一次</span><br>        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) &#123;<br>            userService.saveBatch(list);<br>            list.clear();<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    System.out.println(<span class="hljs-string">&quot;耗时：&quot;</span> + (e - b));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>执行最终耗时如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/3m6K4PzT.png" alt="image.png"><br>可以看到使用了批处理以后，比逐条新增效率提高了10倍左右，性能还是不错的。</p>
<p>不过，我们简单查看一下<code>MybatisPlus</code>源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveBatch</span><span class="hljs-params">(Collection&lt;T&gt; entityList, <span class="hljs-type">int</span> batchSize)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">sqlStatement</span> <span class="hljs-operator">=</span> getSqlStatement(SqlMethod.INSERT_ONE);<br>    <span class="hljs-keyword">return</span> executeBatch(entityList, batchSize, (sqlSession, entity) -&gt; sqlSession.insert(sqlStatement, entity));<br>&#125;<br><span class="hljs-comment">// ...SqlHelper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;E&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">executeBatch</span><span class="hljs-params">(Class&lt;?&gt; entityClass, Log log, Collection&lt;E&gt; list, <span class="hljs-type">int</span> batchSize, BiConsumer&lt;SqlSession, E&gt; consumer)</span> &#123;<br>    Assert.isFalse(batchSize &lt; <span class="hljs-number">1</span>, <span class="hljs-string">&quot;batchSize must not be less than one&quot;</span>);<br>    <span class="hljs-keyword">return</span> !CollectionUtils.isEmpty(list) &amp;&amp; executeBatch(entityClass, log, sqlSession -&gt; &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> list.size();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">idxLimit</span> <span class="hljs-operator">=</span> Math.min(batchSize, size);<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">for</span> (E element : list) &#123;<br>            consumer.accept(sqlSession, element);<br>            <span class="hljs-keyword">if</span> (i == idxLimit) &#123;<br>                sqlSession.flushStatements();<br>                idxLimit = Math.min(idxLimit + batchSize, size);<br>            &#125;<br>            i++;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以发现其实<code>MybatisPlus</code>的批处理是基于<code>PrepareStatement</code>的预编译模式，然后批量提交，最终在数据库执行时还是会有多条insert语句，逐条插入数据。SQL类似这样：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">Preparing: INSERT INTO <span class="hljs-title function_">user</span> <span class="hljs-params">( username, password, phone, info, balance, create_time, update_time )</span> VALUES ( ?, ?, ?, ?, ?, ?, ? )<br>Parameters: user_1, <span class="hljs-number">123</span>, <span class="hljs-number">18688190001</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span><br>Parameters: user_2, <span class="hljs-number">123</span>, <span class="hljs-number">18688190002</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span><br>Parameters: user_3, <span class="hljs-number">123</span>, <span class="hljs-number">18688190003</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span>, <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">01</span><br></code></pre></td></tr></table></figure>

<p>而如果想要得到最佳性能，最好是将多条SQL合并为一条，像这样：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">user</span> ( username, password, phone, info, balance, create_time, update_time )<br><span class="hljs-keyword">VALUES</span> <br>(user_1, <span class="hljs-number">123</span>, <span class="hljs-number">18688190001</span>, &quot;&quot;, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>),<br>(user_2, <span class="hljs-number">123</span>, <span class="hljs-number">18688190002</span>, &quot;&quot;, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>),<br>(user_3, <span class="hljs-number">123</span>, <span class="hljs-number">18688190003</span>, &quot;&quot;, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>),<br>(user_4, <span class="hljs-number">123</span>, <span class="hljs-number">18688190004</span>, &quot;&quot;, <span class="hljs-number">2000</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>, <span class="hljs-number">2023</span><span class="hljs-number">-07</span><span class="hljs-number">-01</span>);<br></code></pre></td></tr></table></figure>

<p>该怎么做呢？</p>
<p>MySQL的客户端连接参数中有这样的一个参数：<code>rewriteBatchedStatements</code>。顾名思义，就是重写批处理的<code>statement</code>语句。参考文档：<br><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/connector-j/8.0/en/connector-j-connp-props-performance-extensions.html#cj-conn-prop_rewriteBatchedStatements">cj-conn-prop_rewriteBatchedStatements</a><br>这个参数的默认值是false，我们需要修改连接参数，将其配置为true</p>
<p>修改项目中的application.yml文件，在jdbc的url后面添加参数<code>&amp;rewriteBatchedStatements=true</code>:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">MySQL123</span><br></code></pre></td></tr></table></figure>

<p>再次测试插入10万条数据，可以发现速度有非常明显的提升：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/3w87AgNv.png" alt="image.png"></p>
<p>在<code>ClientPreparedStatement</code>的<code>executeBatchInternal</code>中，有判断<code>rewriteBatchedStatements</code>值是否为true并重写SQL的功能：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/K0vXKCWw.png" alt="image.png"><br>最终，SQL被重写了：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/9y7FQFXY.png" alt="image.png"></p>
<blockquote>
<p>总结:</p>
<ol>
<li><p>插入大量数据的时候，使用<code>saveBatch</code>批量插入一定数量的数据而不是在循环里面一条一条插入数据<code>save</code></p>
</li>
<li><p>mysql配置文件中开启批处理</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mp？rewriteBatchedStatements=true</span> <span class="hljs-comment">#rewriteBatchedStatements=true 开启批处理</span><br></code></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h4 id="4-3-4-Lambda"><a href="#4-3-4-Lambda" class="headerlink" title="4.3.4 Lambda"></a>4.3.4 Lambda</h4><p>Service中对<code>LambdaQueryWrapper</code>和<code>LambdaUpdateWrapper</code>的用法进一步做了简化。我们无需自己通过<code>new</code>的方式来创建<code>Wrapper</code>，而是直接调用<code>lambdaQuery</code>和<code>lambdaUpdate</code>方法：</p>
<p>基于Lambda查询：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testLambdaQuery</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.查询1个</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">rose</span> <span class="hljs-operator">=</span> userService.lambdaQuery()<br>            .eq(User::getUsername, <span class="hljs-string">&quot;Rose&quot;</span>)<br>            .one(); <span class="hljs-comment">// .one()查询1个</span><br>    System.out.println(<span class="hljs-string">&quot;rose = &quot;</span> + rose);<br><br>    <span class="hljs-comment">// 2.查询多个</span><br>    List&lt;User&gt; users = userService.lambdaQuery()<br>            .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>            .list(); <span class="hljs-comment">// .list()查询集合</span><br>    users.forEach(System.out::println);<br><br>    <span class="hljs-comment">// 3.count统计</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> userService.lambdaQuery()<br>            .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>            .count(); <span class="hljs-comment">// .count()则计数</span><br>    System.out.println(<span class="hljs-string">&quot;count = &quot;</span> + count);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以发现lambdaQuery方法中除了可以构建条件，而且根据链式编程的最后一个方法来判断最终的返回结果，可选的方法有：</p>
<ul>
<li><code>.one()</code>：最多1个结果</li>
<li><code>.list()</code>：返回集合结果</li>
<li><code>.count()</code>：返回计数结果</li>
</ul>
<p>lambdaQuery还支持动态条件查询。比如下面这个需求：</p>
<blockquote>
<p>定义一个方法，接收参数为username、status、minBalance、maxBalance，参数可以为空。</p>
<ul>
<li>如果username参数不为空，则采用模糊查询;</li>
<li>如果status参数不为空，则采用精确匹配；</li>
<li>如果minBalance参数不为空，则余额必须大于minBalance</li>
<li>如果maxBalance参数不为空，则余额必须小于maxBalance</li>
</ul>
</blockquote>
<p>这个需求就是典型的动态查询，在业务开发中经常碰到，实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQueryUser</span><span class="hljs-params">()</span> &#123;<br>    List&lt;User&gt; users = queryUser(<span class="hljs-string">&quot;o&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>    users.forEach(System.out::println);<br>&#125;<br><br><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryUser</span><span class="hljs-params">(String username, Integer status, Integer minBalance, Integer maxBalance)</span> &#123;<br>    <span class="hljs-keyword">return</span> userService.lambdaQuery()<br>            .like(username != <span class="hljs-literal">null</span> , User::getUsername, username)<br>            .eq(status != <span class="hljs-literal">null</span>, User::getStatus, status)<br>            .ge(minBalance != <span class="hljs-literal">null</span>, User::getBalance, minBalance)<br>            .le(maxBalance != <span class="hljs-literal">null</span>, User::getBalance, maxBalance)<br>            .list();<br>&#125;<br></code></pre></td></tr></table></figure>


<p>基于Lambda更新：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testLambdaUpdate</span><span class="hljs-params">()</span> &#123;<br>    userService.lambdaUpdate()<br>            .set(User::getBalance, <span class="hljs-number">800</span>) <span class="hljs-comment">// set balance = 800</span><br>            .eq(User::getUsername, <span class="hljs-string">&quot;Jack&quot;</span>) <span class="hljs-comment">// where username = &quot;Jack&quot;</span><br>            .update(); <span class="hljs-comment">// 执行Update</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>lambdaUpdate()</code>方法后基于链式编程，可以添加<code>set</code>条件和<code>where</code>条件。但最后一定要跟上<code>update()</code>，否则语句不会执行。</p>
<p>lambdaUpdate()同样支持动态条件，例如下面的需求：</p>
<blockquote>
<p>基于IService中的lambdaUpdate()方法实现一个更新方法，满足下列需求：</p>
<ul>
<li>参数为balance、id、username</li>
<li>id或username至少一个不为空，根据id或username精确匹配用户</li>
<li>将匹配到的用户余额修改为balance</li>
<li>如果balance为0，则将用户status修改为冻结状态</li>
</ul>
</blockquote>
<p>实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testUpdateBalance</span><span class="hljs-params">()</span> &#123;<br>    updateBalance(<span class="hljs-number">0L</span>, <span class="hljs-number">1L</span>, <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateBalance</span><span class="hljs-params">(Long balance, Long id, String username)</span>&#123;<br>    userService.lambdaUpdate()<br>            .set(User::getBalance, balance)<br>            .set(balance == <span class="hljs-number">0</span>, User::getStatus, <span class="hljs-number">2</span>)<br>            .eq(id != <span class="hljs-literal">null</span>, User::getId, id)<br>            .eq(username != <span class="hljs-literal">null</span>, User::getId, username)<br>            .update();<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-4-静态工具"><a href="#4-4-静态工具" class="headerlink" title="4.4.静态工具"></a>4.4.静态工具</h3><p>有的时候Service之间也会相互调用，为了避免出现循环依赖问题，MybatisPlus提供一个静态工具类：<code>Db</code>，其中的一些静态方法与<code>IService</code>中方法签名基本一致，也可以帮助我们实现CRUD功能：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/BsapLoQj.png" alt="image.png"></p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbGet</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> Db.getById(<span class="hljs-number">1L</span>, User.class);<br>    System.out.println(user);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 利用Db实现复杂条件查询</span><br>    List&lt;User&gt; list = Db.lambdaQuery(User.class)<br>            .like(User::getUsername, <span class="hljs-string">&quot;o&quot;</span>)<br>            .ge(User::getBalance, <span class="hljs-number">1000</span>)<br>            .list();<br>    list.forEach(System.out::println);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testDbUpdate</span><span class="hljs-params">()</span> &#123;<br>    Db.lambdaUpdate(User.class)<br>            .set(User::getBalance, <span class="hljs-number">2000</span>)<br>            .eq(User::getUsername, <span class="hljs-string">&quot;Rose&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-拓展功能"><a href="#5-拓展功能" class="headerlink" title="5.拓展功能"></a>5.拓展功能</h2><h3 id="5-1-代码生成插件"><a href="#5-1-代码生成插件" class="headerlink" title="5.1 代码生成插件"></a>5.1 代码生成插件</h3><ol>
<li>安装插件</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/oZkvc41U.png" alt="image.png"></p>
<ol start="2">
<li>配置数据库</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/naMirTBz.png" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/uHRd7Xky.png" alt="image.png"></p>
<ol start="3">
<li><p>生成代码</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/85YOQRj9.png" alt="image.png"></p>
</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/dHdRGTLq.png" alt="image.png"></p>
<h3 id="5-2-逻辑删除"><a href="#5-2-逻辑删除" class="headerlink" title="5.2 逻辑删除"></a>5.2 逻辑删除</h3><p>对于一些比较重要的数据，我们往往会采用逻辑删除的方案，即：</p>
<ul>
<li>在表中添加一个字段标记数据是否被删除</li>
<li>当删除数据时把标记置为true</li>
<li>查询时过滤掉标记为true的数据</li>
</ul>
<p>一旦采用了逻辑删除，所有的查询和删除逻辑都要跟着变化，非常麻烦。为了解决这个问题，MybatisPlus就添加了对逻辑删除的支持。<br>:::warning<br><strong>注意</strong>，只有MybatisPlus生成的SQL语句才支持自动的逻辑删除，自定义SQL需要自己手动处理逻辑删除。<br>:::</p>
<p>例如，我们给<code>address</code>表添加一个逻辑删除字段：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> address<br>	<span class="hljs-keyword">add</span> deleted bit <span class="hljs-keyword">default</span> b<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;逻辑删除&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>然后给<code>Address</code>实体添加<code>deleted</code>字段：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/7yMg8Ned.png" alt="image.png"></p>
<p>接下来，我们要在<code>application.yml</code>中配置逻辑删除字段：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">logic-delete-field:</span> <span class="hljs-string">deleted</span> <span class="hljs-comment"># 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)</span><br>      <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 逻辑已删除值(默认为 1)</span><br>      <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span> <span class="hljs-comment"># 逻辑未删除值(默认为 0)</span><br></code></pre></td></tr></table></figure>

<p>测试：<br>首先，我们执行一个删除操作：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testDeleteByLogic</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 删除方法与以前没有区别</span><br>    addressService.removeById(<span class="hljs-number">59L</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>方法与普通删除一模一样，但是底层的SQL逻辑变了：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/F764ALZ9.png" alt="image.png"></p>
<p>查询一下试试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testQuery</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Address&gt; list = addressService.list();<br>    list.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>会发现id为59的确实没有查询出来，而且SQL中也对逻辑删除字段做了判断：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/iVAzYJEP.png" alt="image.png"></p>
<p>综上， 开启了逻辑删除功能以后，我们就可以像普通删除一样做CRUD，基本不用考虑代码逻辑问题。还是非常方便的。</p>
<p>:::warning<br><strong>注意</strong>：<br>逻辑删除本身也有自己的问题，比如：</p>
<ul>
<li>会导致数据库表垃圾数据越来越多，从而影响查询效率</li>
<li>SQL中全都需要对逻辑删除字段做判断，影响查询效率</li>
</ul>
<p>因此，我不太推荐采用逻辑删除功能，如果数据不能删除，可以采用把数据迁移到其它表的办法。<br>:::</p>
<h3 id="5-3-通用枚举"><a href="#5-3-通用枚举" class="headerlink" title="5.3 通用枚举"></a>5.3 通用枚举</h3><p>User类中有一个用户状态字段：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/A2iNFo9N.png" alt="image.png"><br>像这种字段我们一般会定义一个枚举，做业务判断的时候就可以直接基于枚举做比较。但是我们数据库采用的是<code>int</code>类型，对应的PO也是<code>Integer</code>。因此业务操作时必须手动把<code>枚举</code>与<code>Integer</code>转换，非常麻烦。</p>
<p>因此，MybatisPlus提供了一个处理枚举的类型转换器，可以帮我们<strong>把枚举类型与数据库类型自动转换</strong>。</p>
<h4 id="5-3-1-定义枚举"><a href="#5-3-1-定义枚举" class="headerlink" title="5.3.1.定义枚举"></a>5.3.1.定义枚举</h4><p>我们定义一个用户状态的枚举：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/3zYvEl0h.png" alt="image.png"><br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.enums;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.EnumValue;<br><span class="hljs-keyword">import</span> lombok.Getter;<br><br><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UserStatus</span> &#123;<br>    NORMAL(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;正常&quot;</span>),<br>    FREEZE(<span class="hljs-number">2</span>, <span class="hljs-string">&quot;冻结&quot;</span>)<br>    ;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> value;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;<br><br>    UserStatus(<span class="hljs-type">int</span> value, String desc) &#123;<br>        <span class="hljs-built_in">this</span>.value = value;<br>        <span class="hljs-built_in">this</span>.desc = desc;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>然后把<code>User</code>类中的<code>status</code>字段改为<code>UserStatus</code> 类型：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/uOuWLie2.png" alt="image.png"></p>
<p>要让<code>MybatisPlus</code>处理枚举与数据库类型自动转换，我们必须告诉<code>MybatisPlus</code>，枚举中的哪个字段的值作为数据库值。<br><code>MybatisPlus</code>提供了<code>@EnumValue</code>注解来标记枚举属性：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/2os8O1jy.png" alt="image.png"></p>
<h4 id="5-3-2-配置枚举处理器"><a href="#5-3-2-配置枚举处理器" class="headerlink" title="5.3.2.配置枚举处理器"></a>5.3.2.配置枚举处理器</h4><p>在application.yaml文件中添加配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">configuration:</span><br>    <span class="hljs-attr">default-enum-type-handler:</span> <span class="hljs-string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span><br></code></pre></td></tr></table></figure>

<h4 id="5-3-3-测试"><a href="#5-3-3-测试" class="headerlink" title="5.3.3.测试"></a>5.3.3.测试</h4><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testService</span><span class="hljs-params">()</span> &#123;<br>    List&lt;User&gt; list = userService.list();<br>    list.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最终，查询出的<code>User</code>类的<code>status</code>字段会是枚举类型：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/w6yhRekl.png" alt="image.png"></p>
<h3 id="5-4-字段类型处理器"><a href="#5-4-字段类型处理器" class="headerlink" title="5.4 字段类型处理器"></a>5.4 字段类型处理器</h3><p>数据库的user表中有一个<code>info</code>字段，是JSON类型：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/aq5pnfGN.png" alt="image.png"><br>格式像这样：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;intro&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;佛系青年&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;male&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p>而目前<code>User</code>实体类中却是<code>String</code>类型：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/bST1cToI.png" alt="image.png"></p>
<p>这样以来，我们要读取info中的属性时就非常不方便。如果要方便获取，info的类型最好是一个<code>Map</code>或者实体类。<br>而一旦我们把<code>info</code>改为<code>对象</code>类型，就需要在写入数据库是手动转为<code>String</code>，再读取数据库时，手动转换为<code>对象</code>，这会非常麻烦。</p>
<p>因此MybatisPlus提供了很多特殊类型字段的类型处理器，解决特殊字段类型与数据库类型转换的问题。例如处理JSON就可以使用<code>JacksonTypeHandler</code>处理器。</p>
<p>接下来，我们就来看看这个处理器该如何使用。</p>
<h4 id="5-4-1-定义实体"><a href="#5-4-1-定义实体" class="headerlink" title="5.4.1 定义实体"></a>5.4.1 定义实体</h4><p>首先，我们定义一个单独实体类来与info字段的属性匹配：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/k7dLTXuX.png" alt="image.png"><br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.po;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String intro;<br>    <span class="hljs-keyword">private</span> String gender;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="5-4-2-使用类型处理器"><a href="#5-4-2-使用类型处理器" class="headerlink" title="5.4.2 使用类型处理器"></a>5.4.2 使用类型处理器</h4><p>接下来，将User类的info字段修改为UserInfo类型，并声明类型处理器：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/WgvyOE3Q.png" alt="image.png"></p>
<p>测试可以发现，所有数据都正确封装到UserInfo当中了：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/3vnjQq6c.png" alt="image.png"></p>
<h3 id="5-5配置加密"><a href="#5-5配置加密" class="headerlink" title="5.5配置加密"></a>5.5配置加密</h3><p>目前我们配置文件中的很多参数都是明文，如果开发人员发生流动，很容易导致敏感信息的泄露。所以MybatisPlus支持配置文件的加密和解密功能。</p>
<p>我们以数据库的用户名和密码为例。</p>
<h4 id="5-5-1-生成秘钥"><a href="#5-5-1-生成秘钥" class="headerlink" title="5.5.1.生成秘钥"></a>5.5.1.生成秘钥</h4><p>首先，我们利用AES工具生成一个随机秘钥，然后对用户名、密码加密：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.toolkit.AES;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MpDemoApplicationTests</span> &#123;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 生成 16 位随机 AES 密钥</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">randomKey</span> <span class="hljs-operator">=</span> AES.generateRandomKey();<br>        System.out.println(<span class="hljs-string">&quot;randomKey = &quot;</span> + randomKey);<br><br>        <span class="hljs-comment">// 利用密钥对用户名加密</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> AES.encrypt(<span class="hljs-string">&quot;root&quot;</span>, randomKey);<br>        System.out.println(<span class="hljs-string">&quot;username = &quot;</span> + username);<br><br>        <span class="hljs-comment">// 利用密钥对用户名加密</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> AES.encrypt(<span class="hljs-string">&quot;MySQL123&quot;</span>, randomKey);<br>        System.out.println(<span class="hljs-string">&quot;password = &quot;</span> + password);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>打印结果如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">randomKey = 6234633<span class="hljs-type">a66fb399f</span><br><span class="hljs-variable">username</span> <span class="hljs-operator">=</span> px2bAbnUfiY8K/IgsKvscg==<br>password = FGvCSEaOuga3ulDAsxw68Q==<br></code></pre></td></tr></table></figure>

<h4 id="5-5-2-修改配置"><a href="#5-5-2-修改配置" class="headerlink" title="5.5.2.修改配置"></a>5.5.2.修改配置</h4><p>修改application.yaml文件，把jdbc的用户名、密码修改为刚刚加密生成的密文：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">mpw:QWWVnk1Oal3258x5rVhaeQ==</span> <span class="hljs-comment"># 密文要以 mpw:开头</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">mpw:EUFmeH3cNAzdRGdOQcabWg==</span> <span class="hljs-comment"># 密文要以 mpw:开头</span><br></code></pre></td></tr></table></figure>

<h4 id="5-5-3-测试"><a href="#5-5-3-测试" class="headerlink" title="5.5.3.测试"></a>5.5.3.测试</h4><p>在启动项目的时候，需要把刚才生成的秘钥添加到启动参数中，像这样：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">--mpw.key=6234633a66fb399f</span><br></code></pre></td></tr></table></figure>

<p>单元测试的时候不能添加启动参数，所以要在测试类的注解上配置：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/16rM2gf0.png" alt="image.png"></p>
<p>然后随意运行一个单元测试，可以发现数据库查询正常。</p>
<h2 id="6-插件功能"><a href="#6-插件功能" class="headerlink" title="6.插件功能"></a>6.插件功能</h2><p>MybatisPlus提供了很多的插件功能，进一步拓展其功能。目前已有的插件有：</p>
<ul>
<li><code>PaginationInnerInterceptor</code>：自动分页</li>
<li><code>TenantLineInnerInterceptor</code>：多租户</li>
<li><code>DynamicTableNameInnerInterceptor</code>：动态表名</li>
<li><code>OptimisticLockerInnerInterceptor</code>：乐观锁</li>
<li><code>IllegalSQLInnerInterceptor</code>：sql 性能规范</li>
<li><code>BlockAttackInnerInterceptor</code>：防止全表更新与删除</li>
</ul>
<p>:::warning<br><strong>注意：</strong><br>使用多个分页插件的时候需要注意插件定义顺序，建议使用顺序如下：</p>
<ul>
<li>多租户,动态表名</li>
<li>分页,乐观锁</li>
<li>sql 性能规范,防止全表更新与删除<br>:::</li>
</ul>
<p>这里我们以分页插件为里来学习插件的用法。</p>
<h2 id="6-1-分页插件"><a href="#6-1-分页插件" class="headerlink" title="6.1.分页插件"></a>6.1.分页插件</h2><p>在未引入分页插件的情况下，<code>MybatisPlus</code>是不支持分页功能的，<code>IService</code>和<code>BaseMapper</code>中的分页方法都无法正常起效。<br>所以，我们必须配置分页插件。</p>
<h3 id="6-1-1-配置分页插件"><a href="#6-1-1-配置分页插件" class="headerlink" title="6.1.1.配置分页插件"></a>6.1.1.配置分页插件</h3><p>在项目中新建一个配置类：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/9PzTCvqq.png" alt="image.png"><br>其代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.config;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 初始化核心插件</span><br>        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();<br>        <span class="hljs-comment">// 添加分页插件</span><br>        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));<br>        <span class="hljs-keyword">return</span> interceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-1-2-分页API"><a href="#6-1-2-分页API" class="headerlink" title="6.1.2.分页API"></a>6.1.2.分页API</h3><p>编写一个分页查询的测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testPageQuery</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.分页查询，new Page()的两个参数分别是：页码、每页大小</span><br>    Page&lt;User&gt; p = userService.page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>));<br>    <span class="hljs-comment">// 2.总条数</span><br>    System.out.println(<span class="hljs-string">&quot;total = &quot;</span> + p.getTotal());<br>    <span class="hljs-comment">// 3.总页数</span><br>    System.out.println(<span class="hljs-string">&quot;pages = &quot;</span> + p.getPages());<br>    <span class="hljs-comment">// 4.数据</span><br>    List&lt;User&gt; records = p.getRecords();<br>    records.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>运行的SQL如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/5PN2uYu4.png" alt="image.png"></p>
<p>这里用到了分页参数，Page，即可以支持分页参数，也可以支持排序参数。常见的API如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">pageNo</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>, pageSize = <span class="hljs-number">5</span>;<br><span class="hljs-comment">// 分页参数</span><br>Page&lt;User&gt; page = Page.of(pageNo, pageSize);<br><span class="hljs-comment">// 排序参数, 通过OrderItem来指定</span><br>page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">&quot;balance&quot;</span>, <span class="hljs-literal">false</span>));<br><br>userService.page(page);<br></code></pre></td></tr></table></figure>

<h2 id="6-2-通用分页实体"><a href="#6-2-通用分页实体" class="headerlink" title="6.2.通用分页实体"></a>6.2.通用分页实体</h2><p>现在要实现一个用户分页查询的接口，接口规范如下：</p>
<table>
<thead>
<tr>
<th><strong>参数</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>请求方式</td>
<td>GET</td>
</tr>
<tr>
<td>请求路径</td>
<td>&#x2F;users&#x2F;page</td>
</tr>
<tr>
<td>请求参数</td>
<td>&#96;&#96;&#96;json</td>
</tr>
<tr>
<td>{</td>
<td></td>
</tr>
<tr>
<td>“pageNo”: 1,</td>
<td></td>
</tr>
<tr>
<td>“pageSize”: 5,</td>
<td></td>
</tr>
<tr>
<td>“sortBy”: “balance”,</td>
<td></td>
</tr>
<tr>
<td>“isAsc”: false</td>
<td></td>
</tr>
<tr>
<td>}</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100006</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50003</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1685100878975279298</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user_9****&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;intro&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;英文老师&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;female&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;正常&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;balance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1685100878975279299</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;username&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user_9****&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;age&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;intro&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;英文老师&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;gender&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;female&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;正常&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;balance&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2000</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<p> |<br>| 特殊说明 | •如果排序字段为空，默认按照更新时间排序<br>•排序字段不为空，则按照排序字段排序 |</p>
<p>这里需要定义3个实体：</p>
<ul>
<li><code>PageQuery</code>：分页查询条件的实体，包含分页、排序参数</li>
<li><code>PageDTO</code>：分页结果实体，包含总条数、总页数、当前页数据</li>
<li><code>UserVO</code>：用户页面视图实体</li>
</ul>
<p>接下来我们就按照WEB开发的过程来实现这个接口。<br>首先，我们在项目中引入<code>spring-boot-starter-web</code>依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- web依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- hutool 工具包--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>然后，按<code>alt+8</code>打开<code>service</code>控制台，然后添加一个<code>SpringBoot</code>启动项：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/1DTOVtUk.png" alt="image.png"><br>弹窗中选择<code>Spring Boot</code>：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/ZmNq45SJ.png" alt="image.png"><br>弹窗中填写信息：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/E3jepma1.png" alt="image.png"><br>其中不要忘了配置我们之前添加的数据加密的秘钥。</p>
<h3 id="6-2-1-实体"><a href="#6-2-1-实体" class="headerlink" title="6.2.1.实体"></a>6.2.1.实体</h3><p>首先是请求参数的<code>PageQuery</code>实体：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/MrS9Q87H.png" alt="image.png"><br><code>PageQuery</code>是前端提交的查询参数，一般包含四个属性：</p>
<ul>
<li><code>pageNo</code>：页码</li>
<li><code>pageSize</code>：每页数据条数</li>
<li><code>sortBy</code>：排序字段</li>
<li><code>isAsc</code>：是否升序</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.query;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageQuery</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer pageNo;<br>    <span class="hljs-keyword">private</span> Integer pageSize;<br>    <span class="hljs-keyword">private</span> String sortBy;<br>    <span class="hljs-keyword">private</span> Boolean isAsc;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后我们定义一个<code>UserVO</code>实体：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/ZxSIuWqc.png" alt="image.png"><br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.vo;<br><br><span class="hljs-keyword">import</span> com.itheima.mp.domain.po.UserInfo;<br><span class="hljs-keyword">import</span> com.itheima.mp.enums.UserStatus;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserVO</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户名</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 详细信息</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> UserInfo info;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 使用状态（1正常 2冻结）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> UserStatus status;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 账户余额</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer balance;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最后，则是分页实体PageDTO:<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/LmM2zHnS.png" alt="image.png"></p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.dto;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageDTO</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> Integer total;<br>    <span class="hljs-keyword">private</span> Integer pages;<br>    <span class="hljs-keyword">private</span> List&lt;T&gt; list;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="6-2-2-开发接口"><a href="#6-2-2-开发接口" class="headerlink" title="6.2.2.开发接口"></a>6.2.2.开发接口</h3><p>我们定义一个<code>UserController</code>，在<code>controller</code>中我们定义分页查询用户的接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.controller;<br><br><span class="hljs-keyword">import</span> com.itheima.mp.domain.dto.PageDTO;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.query.PageQuery;<br><span class="hljs-keyword">import</span> com.itheima.mp.domain.vo.UserVO;<br><span class="hljs-keyword">import</span> com.itheima.mp.service.UserService;<br><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;users&quot;)</span><br><span class="hljs-meta">@RequiredArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/page&quot;)</span><br>    <span class="hljs-keyword">public</span> PageDTO&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(PageQuery query)</span>&#123;<br>        <span class="hljs-keyword">return</span> userService.queryUserByPage(query);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>然后在<code>UserService</code>中创建<code>queryUserByPage</code>方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java">PageDTO&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(PageQuery query)</span>;<br></code></pre></td></tr></table></figure>

<p>接下来，在UserServiceImpl中实现该方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PageDTO&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(PageQuery query)</span> &#123;<br>    <span class="hljs-comment">// 1.构建条件</span><br>    <span class="hljs-comment">// 1.1.分页条件</span><br>    Page&lt;User&gt; page = Page.of(query.getPageNo(), query.getPageSize());<br>    <span class="hljs-comment">// 1.2.排序条件</span><br>    <span class="hljs-keyword">if</span> (query.getSortBy() != <span class="hljs-literal">null</span>) &#123;<br>        page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(query.getSortBy(), query.getIsAsc()));<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// 默认按照更新时间排序</span><br>        page.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(<span class="hljs-string">&quot;update_time&quot;</span>, <span class="hljs-literal">false</span>));<br>    &#125;<br>    <span class="hljs-comment">// 2.查询</span><br>    page(page);<br>    <span class="hljs-comment">// 3.数据非空校验</span><br>    List&lt;User&gt; records = page.getRecords();<br>    <span class="hljs-keyword">if</span> (records == <span class="hljs-literal">null</span> || records.size() &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// 无数据，返回空结果</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;&gt;(page.getTotal(), page.getPages(), Collections.emptyList());<br>    &#125;<br>    <span class="hljs-comment">// 4.有数据，转换</span><br>    List&lt;UserVO&gt; list = BeanUtil.copyToList(records, UserVO.class);<br>    <span class="hljs-comment">// 5.封装返回</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;UserVO&gt;(page.getTotal(), page.getPages(), list);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最后，为了让UserStatus枚举可以展示为文字描述，再给UserStatus中的desc字段添加<code>@JsonValue</code>注解：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/7vsAS771.png" alt="image.png"><br>启动项目，在页面查看：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/bugqTciD.png" alt="image.png"></p>
<h3 id="6-2-3-改造PageQuery实体"><a href="#6-2-3-改造PageQuery实体" class="headerlink" title="6.2.3.改造PageQuery实体"></a>6.2.3.改造PageQuery实体</h3><p>在刚才的代码中，从<code>PageQuery</code>到<code>MybatisPlus</code>的<code>Page</code>之间转换的过程还是比较麻烦的。<br>我们完全可以在<code>PageQuery</code>这个实体中定义一个工具方法，简化开发。<br>像这样：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.query;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageQuery</span> &#123;<br>    <span class="hljs-keyword">private</span> Integer pageNo;<br>    <span class="hljs-keyword">private</span> Integer pageSize;<br>    <span class="hljs-keyword">private</span> String sortBy;<br>    <span class="hljs-keyword">private</span> Boolean isAsc;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt;  Page&lt;T&gt; <span class="hljs-title function_">toMpPage</span><span class="hljs-params">(OrderItem ... orders)</span>&#123;<br>        <span class="hljs-comment">// 1.分页条件</span><br>        Page&lt;T&gt; p = Page.of(pageNo, pageSize);<br>        <span class="hljs-comment">// 2.排序条件</span><br>        <span class="hljs-comment">// 2.1.先看前端有没有传排序字段</span><br>        <span class="hljs-keyword">if</span> (sortBy != <span class="hljs-literal">null</span>) &#123;<br>            p.addOrder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(sortBy, isAsc));<br>            <span class="hljs-keyword">return</span> p;<br>        &#125;<br>        <span class="hljs-comment">// 2.2.再看有没有手动指定排序字段</span><br>        <span class="hljs-keyword">if</span>(orders != <span class="hljs-literal">null</span>)&#123;<br>            p.addOrder(orders);<br>        &#125;<br>        <span class="hljs-keyword">return</span> p;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="hljs-title function_">toMpPage</span><span class="hljs-params">(String defaultSortBy, <span class="hljs-type">boolean</span> isAsc)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.toMpPage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>(defaultSortBy, isAsc));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="hljs-title function_">toMpPageDefaultSortByCreateTimeDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> toMpPage(<span class="hljs-string">&quot;create_time&quot;</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="hljs-title function_">toMpPageDefaultSortByUpdateTimeDesc</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> toMpPage(<span class="hljs-string">&quot;update_time&quot;</span>, <span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>这样我们在开发也时就可以省去对从<code>PageQuery</code>到<code>Page</code>的的转换：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 1.构建条件</span><br>Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();<br></code></pre></td></tr></table></figure>

<h3 id="6-2-4-改造PageDTO实体"><a href="#6-2-4-改造PageDTO实体" class="headerlink" title="6.2.4.改造PageDTO实体"></a>6.2.4.改造PageDTO实体</h3><p>在查询出分页结果后，数据的非空校验，数据的vo转换都是模板代码，编写起来很麻烦。</p>
<p>我们完全可以将其封装到PageDTO的工具方法中，简化整个过程：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.itheima.mp.domain.dto;<br><br><span class="hljs-keyword">import</span> cn.hutool.core.bean.BeanUtil;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;<br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.function.Function;<br><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageDTO</span>&lt;V&gt; &#123;<br>    <span class="hljs-keyword">private</span> Long total;<br>    <span class="hljs-keyword">private</span> Long pages;<br>    <span class="hljs-keyword">private</span> List&lt;V&gt; list;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 返回空分页结果</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> p MybatisPlus的分页结果</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;V&gt; 目标VO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;P&gt; 原始PO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> VO的分页对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;V, P&gt; PageDTO&lt;V&gt; <span class="hljs-title function_">empty</span><span class="hljs-params">(Page&lt;P&gt; p)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;&gt;(p.getTotal(), p.getPages(), Collections.emptyList());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将MybatisPlus分页结果转为 VO分页结果</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> p MybatisPlus的分页结果</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> voClass 目标VO类型的字节码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;V&gt; 目标VO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;P&gt; 原始PO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> VO的分页对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;V, P&gt; PageDTO&lt;V&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(Page&lt;P&gt; p, Class&lt;V&gt; voClass)</span> &#123;<br>        <span class="hljs-comment">// 1.非空校验</span><br>        List&lt;P&gt; records = p.getRecords();<br>        <span class="hljs-keyword">if</span> (records == <span class="hljs-literal">null</span> || records.size() &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 无数据，返回空结果</span><br>            <span class="hljs-keyword">return</span> empty(p);<br>        &#125;<br>        <span class="hljs-comment">// 2.数据转换</span><br>        List&lt;V&gt; vos = BeanUtil.copyToList(records, voClass);<br>        <span class="hljs-comment">// 3.封装返回</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;&gt;(p.getTotal(), p.getPages(), vos);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将MybatisPlus分页结果转为 VO分页结果，允许用户自定义PO到VO的转换方式</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> p MybatisPlus的分页结果</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> convertor PO到VO的转换函数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;V&gt; 目标VO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;P&gt; 原始PO类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> VO的分页对象</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;V, P&gt; PageDTO&lt;V&gt; <span class="hljs-title function_">of</span><span class="hljs-params">(Page&lt;P&gt; p, Function&lt;P, V&gt; convertor)</span> &#123;<br>        <span class="hljs-comment">// 1.非空校验</span><br>        List&lt;P&gt; records = p.getRecords();<br>        <span class="hljs-keyword">if</span> (records == <span class="hljs-literal">null</span> || records.size() &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 无数据，返回空结果</span><br>            <span class="hljs-keyword">return</span> empty(p);<br>        &#125;<br>        <span class="hljs-comment">// 2.数据转换</span><br>        List&lt;V&gt; vos = records.stream().map(convertor).collect(Collectors.toList());<br>        <span class="hljs-comment">// 3.封装返回</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageDTO</span>&lt;&gt;(p.getTotal(), p.getPages(), vos);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>最终，业务层的代码可以简化为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PageDTO&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(PageQuery query)</span> &#123;<br>    <span class="hljs-comment">// 1.构建条件</span><br>    Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();<br>    <span class="hljs-comment">// 2.查询</span><br>    page(page);<br>    <span class="hljs-comment">// 3.封装返回</span><br>    <span class="hljs-keyword">return</span> PageDTO.of(page, UserVO.class);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>如果是希望自定义PO到VO的转换过程，可以这样做：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PageDTO&lt;UserVO&gt; <span class="hljs-title function_">queryUserByPage</span><span class="hljs-params">(PageQuery query)</span> &#123;<br>    <span class="hljs-comment">// 1.构建条件</span><br>    Page&lt;User&gt; page = query.toMpPageDefaultSortByCreateTimeDesc();<br>    <span class="hljs-comment">// 2.查询</span><br>    page(page);<br>    <span class="hljs-comment">// 3.封装返回</span><br>    <span class="hljs-keyword">return</span> PageDTO.of(page, user -&gt; &#123;<br>        <span class="hljs-comment">// 拷贝属性到VO</span><br>        <span class="hljs-type">UserVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserVO.class);<br>        <span class="hljs-comment">// 用户名脱敏</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> vo.getUsername();<br>        vo.setUsername(username.substring(<span class="hljs-number">0</span>, username.length() - <span class="hljs-number">2</span>) + <span class="hljs-string">&quot;**&quot;</span>);<br>        <span class="hljs-keyword">return</span> vo;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>最终查询的结果如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/04/TISYE7wq.png" alt="image.png"></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/06/02/wuJknzxaFigDSdL.gif" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/06/02/wuJknzxaFigDSdL.gif" title="头像" alt="头像"></a><div class="post-copyright__author_name">caolibin</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://clibin.gitee.io/2023/08/31/mybatis-plus/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://clibin.gitee.io/2023/08/31/mybatis-plus/')">mybatis-plus</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://clibin.gitee.io/2023/08/31/mybatis-plus/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=mybatis-plus&amp;url=https://clibin.gitee.io/2023/08/31/mybatis-plus/&amp;pic=https://img2.imgtp.com/2024/04/26/dAtgB1Oy.jpeg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://clibin.gitee.io" target="_blank">学海无涯</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/mysql/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>mysql<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/mybatis/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>mybatis<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/java/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>java<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2024/06/02/wuJknzxaFigDSdL.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/31/linux%E5%91%BD%E4%BB%A4/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/26/vSmYRYLp.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">linux命令</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/31/Redis/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/26/uXIQ2MgX.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Redis</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2023/10/14/mybatis/" title="mybatis"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/26/VjORBIMS.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-10-14</div><div class="title">mybatis</div></div></a></div><div><a href="/2023/07/28/mysql/" title="mysql"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/26/wBGeLSLD.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-07-28</div><div class="title">mysql</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2024/06/02/wuJknzxaFigDSdL.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/1bc13fa6b2808.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">caolibin</h1><div class="author-info__desc"></div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/caolib" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/441126797" target="_blank" title="BiliBili"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis-plus"><span class="toc-number">1.</span> <span class="toc-text">mybatis-plus</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.1 导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BAMapper"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2 创建Mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%B5%8B%E8%AF%95CRUD"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.3 测试CRUD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">2.常见注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-TableName"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.1 @TableName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-TableId"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.2  @TableId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-TableField"><span class="toc-number">1.3.3.</span> <span class="toc-text">2.3 @TableField</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%B8%B8%E8%A7%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.</span> <span class="toc-text">3.常见配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.5.</span> <span class="toc-text">&#x3D;&#x3D;4.核心功能&#x3D;&#x3D;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">4.1 条件构造器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-QueryWrapper"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">4.1.1 QueryWrapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-UpdateWrapper"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">4.1.2 UpdateWrapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-LambdaQueryWrapper"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">4.1.3 LambdaQueryWrapper</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E8%87%AA%E5%AE%9A%E4%B9%89SQL"><span class="toc-number">1.5.2.</span> <span class="toc-text">4.2 自定义SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">4.2.1 基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">4.2.2 多表联查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Service%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">4.3 Service接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-CRUD"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">4.3.1.CRUD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">4.3.2 基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-3-%E6%89%B9%E9%87%8F%E6%96%B0%E5%A2%9E"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">4.3.3 批量新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-4-Lambda"><span class="toc-number">1.5.3.4.</span> <span class="toc-text">4.3.4 Lambda</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E9%9D%99%E6%80%81%E5%B7%A5%E5%85%B7"><span class="toc-number">1.5.4.</span> <span class="toc-text">4.4.静态工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%8B%93%E5%B1%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.</span> <span class="toc-text">5.拓展功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E6%8F%92%E4%BB%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">5.1 代码生成插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">5.2 逻辑删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%80%9A%E7%94%A8%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.6.3.</span> <span class="toc-text">5.3 通用枚举</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E5%AE%9A%E4%B9%89%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">5.3.1.定义枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E9%85%8D%E7%BD%AE%E6%9E%9A%E4%B8%BE%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">5.3.2.配置枚举处理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">5.3.3.测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.6.4.</span> <span class="toc-text">5.4 字段类型处理器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">5.4.1 定义实体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">5.4.2 使用类型处理器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5%E9%85%8D%E7%BD%AE%E5%8A%A0%E5%AF%86"><span class="toc-number">1.6.5.</span> <span class="toc-text">5.5配置加密</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-1-%E7%94%9F%E6%88%90%E7%A7%98%E9%92%A5"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">5.5.1.生成秘钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">5.5.2.修改配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">5.5.3.测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%8F%92%E4%BB%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">1.7.</span> <span class="toc-text">6.插件功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">1.8.</span> <span class="toc-text">6.1.分页插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">1.8.1.</span> <span class="toc-text">6.1.1.配置分页插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E5%88%86%E9%A1%B5API"><span class="toc-number">1.8.2.</span> <span class="toc-text">6.1.2.分页API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E9%80%9A%E7%94%A8%E5%88%86%E9%A1%B5%E5%AE%9E%E4%BD%93"><span class="toc-number">1.9.</span> <span class="toc-text">6.2.通用分页实体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E5%AE%9E%E4%BD%93"><span class="toc-number">1.9.1.</span> <span class="toc-text">6.2.1.实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E5%BC%80%E5%8F%91%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.9.2.</span> <span class="toc-text">6.2.2.开发接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E6%94%B9%E9%80%A0PageQuery%E5%AE%9E%E4%BD%93"><span class="toc-number">1.9.3.</span> <span class="toc-text">6.2.3.改造PageQuery实体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E6%94%B9%E9%80%A0PageDTO%E5%AE%9E%E4%BD%93"><span class="toc-number">1.9.4.</span> <span class="toc-text">6.2.4.改造PageDTO实体</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/09/test/" title="test">test</a><time datetime="2024-06-09T07:41:50.000Z" title="发表于 2024-06-09 15:41:50">2024-06-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/27/npm-yarn/" title="npm、yarn 包管理器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://files.codelife.cc/wallhaven/full/mp/wallhaven-mpjj91.jpg?x-oss-process=image/resize,limit_0,m_fill,w_2560,h_1440/quality,Q_92/format,webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="npm、yarn 包管理器"/></a><div class="content"><a class="title" href="/2024/03/27/npm-yarn/" title="npm、yarn 包管理器">npm、yarn 包管理器</a><time datetime="2024-03-27T05:37:44.000Z" title="发表于 2024-03-27 13:37:44">2024-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/25/git/" title="git版本控制系统"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://files.codelife.cc/wallhaven/full/42/wallhaven-42z9em.jpg?x-oss-process=image/resize,limit_0,m_fill,w_2560,h_1440/quality,Q_92/format,webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="git版本控制系统"/></a><div class="content"><a class="title" href="/2024/03/25/git/" title="git版本控制系统">git版本控制系统</a><time datetime="2024-03-25T13:45:03.000Z" title="发表于 2024-03-25 21:45:03">2024-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/19/windows%E5%AE%9A%E6%97%B6%E5%85%B3%E6%9C%BA/" title="windows定时关机"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img2.imgtp.com/2024/04/26/zzTq9wAc.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="windows定时关机"/></a><div class="content"><a class="title" href="/2024/03/19/windows%E5%AE%9A%E6%97%B6%E5%85%B3%E6%9C%BA/" title="windows定时关机">windows定时关机</a><time datetime="2024-03-19T14:28:39.000Z" title="发表于 2024-03-19 22:28:39">2024-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/03/18/apifox%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" title="apifox测试工具"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://files.codelife.cc/wallhaven/full/nr/wallhaven-nr87wm.jpg?x-oss-process=image/resize,limit_0,m_fill,w_2560,h_1440/quality,Q_92/format,webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="apifox测试工具"/></a><div class="content"><a class="title" href="/2024/03/18/apifox%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" title="apifox测试工具">apifox测试工具</a><time datetime="2024-03-18T14:20:23.000Z" title="发表于 2024-03-18 22:20:23">2024-03-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://github.com/caolib/caolib.github.io" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2024 By <a class="footer-bar-link" href="/" title="caolibin" target="_blank">caolibin</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">其他线路</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://clb.pages.dev" title="cloudflare"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/cloudflare.svg" alt="cloudflare"/><span class="back-menu-item-text">cloudflare</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.netlify.app" title="netlify"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/netlify.svg" alt="netlify"/><span class="back-menu-item-text">netlify</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.github.io" title="github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/github.svg" alt="github"/><span class="back-menu-item-text">github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://caolib.vercel.app" title="vercel"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/vercel.svg" alt="vercel"/><span class="back-menu-item-text">vercel</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">我</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/caolib" title="github"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/github.svg" alt="github"/><span class="back-menu-item-text">github</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/clibin" title="gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/gitee.svg" alt="gitee"/><span class="back-menu-item-text">gitee</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NOSQL/" style="font-size: 0.88rem;">NOSQL<sup>1</sup></a><a href="/tags/apifox/" style="font-size: 0.88rem;">apifox<sup>1</sup></a><a href="/tags/axios/" style="font-size: 0.88rem;">axios<sup>1</sup></a><a href="/tags/c/" style="font-size: 0.88rem;">c++<sup>1</sup></a><a href="/tags/everything/" style="font-size: 0.88rem;">everything<sup>1</sup></a><a href="/tags/gateway/" style="font-size: 0.88rem;">gateway<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">java<sup>2</sup></a><a href="/tags/jwt/" style="font-size: 0.88rem;">jwt<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>1</sup></a><a href="/tags/markdown/" style="font-size: 0.88rem;">markdown<sup>1</sup></a><a href="/tags/mybatis/" style="font-size: 0.88rem;">mybatis<sup>2</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>3</sup></a><a href="/tags/nacos/" style="font-size: 0.88rem;">nacos<sup>1</sup></a><a href="/tags/npm/" style="font-size: 0.88rem;">npm<sup>1</sup></a><a href="/tags/os/" style="font-size: 0.88rem;">os<sup>1</sup></a><a href="/tags/pinia/" style="font-size: 0.88rem;">pinia<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>2</sup></a><a href="/tags/shields/" style="font-size: 0.88rem;">shields<sup>1</sup></a><a href="/tags/springboot/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">springboot<sup>2</sup></a><a href="/tags/springcloud/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">springcloud<sup>2</sup></a><a href="/tags/windows/" style="font-size: 0.88rem;">windows<sup>1</sup></a><a href="/tags/%E6%90%9C%E7%B4%A2/" style="font-size: 0.88rem;">搜索<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">数据库<sup>2</sup></a><a href="/tags/%E6%A0%87%E7%AD%BE/" style="font-size: 0.88rem;">标签<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">测试<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">计算机网络<sup>1</sup></a><a href="/tags/%E9%82%AE%E4%BB%B6/" style="font-size: 0.88rem;">邮件<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="9516665896" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"><a class="tag-list" href="/tags/springboot" title="springboot">springboot</a><a class="tag-list" href="/tags/springcloud" title="springcloud">springcloud</a><a class="tag-list" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C" title="计算机网络">计算机网络</a><a class="tag-list" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93" title="数据库">数据库</a></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/my/m/music/playlist?id=9516665896&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("12/26/2023 16:20:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.cbd.int/katex@0.16.0/dist/katex.min.css"><script src="https://cdn.cbd.int/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    anzhiyu.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://clibin-twikoo-comments.hf.space',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://clibin-twikoo-comments.hf.space',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://clibin-twikoo-comments.hf.space',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><div class="aplayer no-destroy" data-id="8400298436" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-mini='true'> </div><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script type="text/javascript">docsearch({appId:5ZERDAEVZ8, apiKey:a026e88a33a21c12f851e20db56e4d88,indexName:tankingcaoio,insights:true,container:div, debug:false});</script><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3IEsC7dmGhpF8yGN",ck:"3IEsC7dmGhpF8yGN"})</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":80,"height":160},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>